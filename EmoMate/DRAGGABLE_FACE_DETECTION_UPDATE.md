# 可拖拽面部检测窗口 + Header测试入口 更新

## 🎯 完成的功能

### 1. **可拖拽面部检测窗口**
- 创建了 `DraggableFacialEmotionDetector` 组件
- 窗口位置：左上角（初始位置）
- 支持手指拖拽移动
- 拖拽时窗口会轻微缩放提供视觉反馈

### 2. **Header下拉菜单测试入口**
- 在Header组件的下拉菜单中添加了 "🧪 情绪测试" 入口
- 该入口只在 debug 模式下显示
- 点击后直接跳转到 EmotionTestScreen

## 📱 组件特性

### **DraggableFacialEmotionDetector**
```typescript
// 主要特性：
- 📍 初始位置：左上角 (x: 20, y: 80)
- 🎯 可拖拽：支持手指拖动到任意位置
- 📷 摄像头预览：前置摄像头实时预览
- 😊 情绪按钮：3个快速情绪测试按钮
- 🔍 调试信息：debug模式下显示当前状态
- 🎨 视觉反馈：拖拽时缩放动画
```

### **Header增强**
```typescript
// 新增功能：
- 🧪 情绪测试入口（仅debug模式）
- 🎯 条件渲染：使用 isDebugMode() 判断
- 🔗 导航集成：直接跳转到 EmotionTestScreen
- 💬 保留原有聊天记录功能
```

## 🚀 使用方法

### **启动Debug模式**
```bash
SHOW_TEST_COMPONENTS=true npm start
```

### **使用拖拽面部检测**
1. 启动应用后，在左上角会看到面部检测窗口
2. 用手指按住窗口可以拖动到任意位置
3. 窗口底部有3个情绪按钮：😊😢😲
4. 点击按钮可以模拟不同的情绪状态
5. 情绪会传递给 Live2D 角色触发相应动画

### **使用Header测试入口**
1. 点击右上角的设置按钮（⚙️）
2. 下拉菜单会显示：
   - 💬 聊天记录
   - 🧪 情绪测试（仅debug模式）
3. 点击 "🧪 情绪测试" 进入完整测试界面

## 🔧 技术实现

### **拖拽功能**
```typescript
// 使用 react-native-reanimated 和 react-native-gesture-handler
- useSharedValue: 管理位置状态
- PanGestureHandler: 处理拖拽手势
- useAnimatedStyle: 实现平滑动画
- withSpring: 提供弹性动画效果
```

### **条件渲染**
```typescript
// Header dropdown 条件渲染
...(isDebugMode() && onGoToEmotionTest ? [
  {
    id: 'emotionTest',
    label: '情绪测试',
    icon: '🧪',
    onPress: () => {
      setIsDropdownVisible(false);
      onGoToEmotionTest?.();
    },
  },
] : [])
```

## 🎨 UI特性

### **拖拽窗口设计**
- 🎯 圆角边框：12px 圆角
- 🎨 阴影效果：轻微阴影提升层次感
- 📏 紧凑尺寸：120x160px
- 🔗 拖拽手柄：顶部小横条指示可拖拽
- 😊 情绪按钮：底部3个表情按钮

### **Header菜单设计**
- 🧪 测试图标：明确的实验室图标
- 🎯 条件显示：只在debug模式显示
- 🔗 一键访问：直接跳转测试界面
- 💫 动画效果：平滑的下拉动画

## 🧪 测试场景

### **拖拽测试**
1. 启动应用确认窗口在左上角
2. 拖拽窗口到屏幕各个位置
3. 验证拖拽过程中的缩放效果
4. 确认拖拽后位置保持不变

### **情绪测试**
1. 点击不同的情绪按钮
2. 观察Live2D角色的动画变化
3. 验证情绪状态的传递
4. 确认5秒后自动返回neutral

### **Header菜单测试**
1. 正常模式：确认没有测试入口
2. Debug模式：确认显示测试入口
3. 点击测试：验证正确跳转
4. 功能完整：确认所有原有功能正常

## 📊 功能对比

| 功能 | 原版本 | 新版本 |
|------|--------|--------|
| 面部检测窗口 | 固定右上角 | 可拖拽，初始左上角 |
| 测试入口 | 无 | Header下拉菜单 |
| 条件显示 | - | 仅debug模式 |
| 用户体验 | 基础 | 增强交互 |

## ✅ 完成清单

- [x] 创建可拖拽面部检测组件
- [x] 设置初始位置为左上角
- [x] 实现拖拽手势处理
- [x] 添加拖拽视觉反馈
- [x] 更新Header组件接口
- [x] 添加debug模式条件渲染
- [x] 集成测试入口到下拉菜单
- [x] 更新HomeScreen导航
- [x] 测试所有功能正常工作

## 🎉 使用指南

现在你可以：
1. **启动debug模式** 查看新功能
2. **拖拽面部检测窗口** 到任意位置
3. **使用Header下拉菜单** 快速进入测试
4. **体验完整的情绪检测** 功能

所有功能都已完成并可以正常使用！