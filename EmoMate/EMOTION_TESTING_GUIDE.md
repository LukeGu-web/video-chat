# 🧪 面部识别功能测试指南

## 🚀 启动应用进行测试

### 1. **启动调试模式**
```bash
cd /Users/yaonangu/Local_doc/GitHub/video-chat/EmoMate
SHOW_TEST_COMPONENTS=true npm start
```

### 2. **在设备上扫描二维码启动应用**

## 📱 测试方法

### **方法A: 主页面集成测试 (推荐)**

现在主页面已经集成了面部情绪检测功能：

1. **启动应用** → 进入主页面 (HomeScreen)
2. **查看右上角** → 会显示一个小的摄像头预览窗口
3. **测试情绪检测**：
   - 摄像头预览下方有三个表情按钮：😊😢😲
   - 点击不同的表情按钮模拟不同情绪
   - **观察Live2D角色** → 会根据你选择的情绪播放对应动画

4. **功能验证**：
   - 😊 (开心) → 角色播放 `Happy` 动画
   - 😢 (难过) → 角色播放 `Sleepy` 动画  
   - 😲 (惊讶) → 角色播放 `Surprised` 动画
   - 5秒后自动返回 `Idle` 状态

### **方法B: 专用测试界面**

如果启用了调试模式，还可以访问完整的测试界面：

1. **导航到 EmotionTestScreen** (调试模式下可用)
2. **完整功能测试**：
   - 📷 面部情绪检测区域
   - 💬 文本情绪分析区域  
   - 🧪 快速情绪测试按钮
   - 🧠 实时情绪状态显示
   - 🎭 Live2D角色动画响应

## 🎯 测试场景

### **场景1: 基础情绪检测**
```
1. 点击 😊 按钮
   ✅ 摄像头预览显示活跃状态
   ✅ Live2D角色播放开心动画
   ✅ 5秒后返回正常状态

2. 点击 😢 按钮  
   ✅ 角色播放难过/疲倦动画
   ✅ 情绪状态正确更新

3. 点击 😲 按钮
   ✅ 角色播放惊讶动画
   ✅ 表情反应及时
```

### **场景2: 文本情绪分析 (在测试界面)**
```
1. 输入 "我今天很开心"
   ✅ 文本分析检测到 happy 情绪
   ✅ 角色做出相应反应

2. 输入 "我觉得很难过"  
   ✅ 检测到 sad 情绪
   ✅ 角色动画切换

3. 输入复杂语句测试Claude AI分析
   ✅ AI语义分析工作正常
```

### **场景3: 组合情绪测试**
```
1. 同时有面部情绪 + 文本情绪
   ✅ 文本情绪优先级更高
   ✅ 组合逻辑正确工作

2. 情绪状态持久性
   ✅ 状态在组件间正确共享  
   ✅ 情绪变化历史记录
```

## 🐛 调试功能

### **调试信息查看**
在调试模式下，你可以看到：

- **摄像头状态**: 权限、连接状态
- **情绪检测状态**: 当前检测到的情绪
- **角色动画状态**: 当前播放的动画
- **情绪历史**: 最近的情绪变化记录
- **组件通信**: 各组件间的数据传递

### **控制台日志**
查看开发者控制台可以看到详细日志：
```
[SimpleFacialEmotionDetector] Manual emotion selected: happy
[EmotionState] Facial emotion changed: neutral -> happy  
[EmotionAwareCharacter] Emotion changed: neutral -> happy
[Live2DCharacter] Motion changed to: Happy
```

## 🔍 预期行为

### **正常工作流程**：
1. 用户点击情绪按钮 → 
2. FacialEmotionDetector 触发回调 →
3. EmotionProvider 更新全局状态 →
4. EmotionAwareCharacter 接收状态变化 →
5. Live2D角色播放对应动画

### **权限处理**：
- 首次使用会请求摄像头权限
- 权限被拒绝时显示友好提示
- 提供重新申请权限的按钮

### **性能优化**：
- 检测间隔限制 (2秒)
- 自动状态重置 (5秒返回neutral)
- 防重复触发机制

## ✅ 测试检查清单

- [ ] 摄像头预览正常显示
- [ ] 权限申请和处理正确
- [ ] 表情按钮响应及时
- [ ] Live2D角色动画正确
- [ ] 情绪状态正确显示
- [ ] 自动重置功能工作
- [ ] 调试信息正确显示
- [ ] 文本情绪分析正常 (测试界面)
- [ ] 组合情绪逻辑正确
- [ ] 无崩溃或错误

## 🚨 故障排除

### **摄像头无法启动**：
- 检查设备权限设置
- 重启应用重新申请权限
- 确认设备摄像头硬件正常

### **角色动画无反应**：  
- 检查角色服务器连接 (192.168.31.28:5174)
- 查看调试日志确认情绪状态传递
- 重启角色服务器

### **情绪检测不准确**：
- 当前为手动控制，确保点击正确按钮
- 未来版本将集成真实的AI面部识别

通过以上测试，你可以验证情绪感知MVP的完整功能！